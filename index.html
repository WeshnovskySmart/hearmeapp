<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HearMe</title>
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —à—Ä–∏—Ñ—Ç—É Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #f9fafb;
            overflow: hidden; 
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --gradient-from: #ef4444;
            --gradient-to: #f97316;
            --glow-color: rgba(239, 68, 68, 0.5);
        }

        .text-gradient { background-image: linear-gradient(to right, var(--gradient-from), var(--gradient-to)); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .bg-gradient-animated { background: linear-gradient(90deg, var(--gradient-from), var(--gradient-to), var(--gradient-from)); background-size: 200% 100%; animation: gradient-flow 5s ease infinite; }
        @keyframes gradient-flow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        @keyframes fadeInSimple { from { opacity: 0; } to { opacity: 1; } }
        .fade-in { animation: fadeInSimple 0.4s ease-out forwards; }
        
        #background-shapes { transition: transform 0.5s ease-out; }
        #background-shapes div { position: absolute; border-radius: 50%; background: linear-gradient(to right,
            rgba(239, 68, 68, 0.1), 
            rgba(249, 115, 22, 0.1)
        ); transition: transform 10s linear; }
        
        .glassmorphism { background: rgba(31, 41, 55, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }

        .btn-primary:hover { box-shadow: 0 0 25px var(--glow-color); }
        .btn-primary:active { transform: scale(0.97); }

        .ripple { position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.3); transform: scale(0); animation: ripple-effect 0.6s linear; }
        @keyframes ripple-effect { to { transform: scale(4); opacity: 0; } }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—ó –ø–æ—à—É–∫—É */
        @keyframes radar-sweep { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .radar-scanner::after { content: ''; position: absolute; left: 50%; top: 0; width: 50%; height: 100%; background: linear-gradient(to top, transparent, var(--gradient-to)); transform-origin: 0 100%; animation: radar-sweep 2s linear infinite; opacity: 0.3; }
        @keyframes typing-dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
        .typing-animation::after { content: '.'; display: inline-block; animation: typing-dots 1.5s steps(3, end) infinite; }

        /* –Ü–Ω—à—ñ —Å—Ç–∏–ª—ñ */
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; }
        .active .accordion-content { max-height: 500px; }
        .active .accordion-icon { transform: rotate(180deg); }
        .chat-message { max-width: 75%; }
        .speaking { box-shadow: 0 0 15px 3px var(--gradient-to); }
    </style>
</head>
<body class="antialiased h-screen w-screen flex items-center justify-center p-4 relative">
    <!-- –ê–Ω—ñ–º–æ–≤–∞–Ω–∏–π —Ñ–æ–Ω -->
    <div id="background-shapes" class="absolute inset-0 z-0 overflow-hidden"></div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –µ–∫—Ä–∞–Ω—ñ–≤ -->
    <div class="w-full max-w-md h-full max-h-[800px] z-10">

        <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
        <div id="preloader-screen" class="w-full h-full flex flex-col items-center justify-center">
             <svg class="w-24 h-24" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:var(--gradient-from)" /><stop offset="100%" style="stop-color:var(--gradient-to)" /></linearGradient></defs>
                <path fill="url(#logoGradient)" d="M50,0C22.4,0,0,22.4,0,50s22.4,50,50,50c13.2,0,25.2-5.1,34.2-13.4c-1.8-4-3.9-8.4-5.3-12.2c-5.9,3.8-13,6-20.7,6c-18.2,0-33-14.8-33-33s14.8-33,33-33c10.1,0,19.1,4.5,25.2,11.8C70.2,5.2,60.6,0,50,0z M84.2,28.6c-4.7-8.2-13.3-13.8-23.2-15.6c4.6,6.3,7.4,14.1,7.4,22.5c0,18.2-14.8,33-33,33c-3.5,0-6.9-0.6-10.1-1.6c4.1,12,15.6,20.5,29.1,20.5c17.6,0,32-14.4,32-32C86.4,45.8,86,36.9,84.2,28.6z"/>
            </svg>
            <h1 class="text-4xl font-extrabold text-gradient mt-4">HearMe</h1>
        </div>

        <!-- –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (–ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø—É—Å–∫—É) -->
        <div id="onboarding-screen" class="hidden w-full h-full flex flex-col items-center justify-center p-4">
            <div class="w-full text-center">
                <h2 class="text-3xl font-bold text-gray-100">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –≤ HearMe!</h2>
                <p class="text-gray-400 mt-2">–ö—ñ–ª—å–∫–∞ –ø—Ä–æ—Å—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è.</p>
            </div>
            <div id="onboarding-steps" class="w-full flex-1 flex items-center justify-center mt-8">
                <div class="onboarding-step text-center">
                    <svg class="w-20 h-20 mx-auto text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <h3 class="text-2xl font-semibold mt-6">–ë—É–¥—å—Ç–µ –≤–≤—ñ—á–ª–∏–≤–∏–º–∏</h3>
                    <p class="text-gray-400 mt-2">–ü–æ–≤–∞–∂–∞–π—Ç–µ —Å–≤–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫–∞. –û–±—Ä–∞–∑–∏ —Ç–∞ —Ç–æ–∫—Å–∏—á–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ —Ç—É—Ç –Ω–µ–ø—Ä–∏–π–Ω—è—Ç–Ω—ñ.</p>
                </div>
                <div class="onboarding-step hidden text-center">
                    <svg class="w-20 h-20 mx-auto text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    <h3 class="text-2xl font-semibold mt-6">–ë–µ–∑ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏—Ö —Ç–µ–º</h3>
                    <p class="text-gray-400 mt-2">–ü–æ–ª—ñ—Ç–∏–∫–∞, —Ä–µ–ª—ñ–≥—ñ—è —Ç–∞ —ñ–Ω—à—ñ —Ç–µ–º–∏, —â–æ —Ä–æ–∑–ø–∞–ª—é—é—Ç—å –≤–æ—Ä–æ–∂–Ω–µ—á—É, –∑–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ.</p>
                </div>
                <div class="onboarding-step hidden text-center">
                    <svg class="w-20 h-20 mx-auto text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    <h3 class="text-2xl font-semibold mt-6">–ù–∞—Å–æ–ª–æ–¥–∂—É–π—Ç–µ—Å—å!</h3>
                    <p class="text-gray-400 mt-2">–ì–æ–ª–æ–≤–Ω–∞ –º–µ—Ç–∞ ‚Äî –∑–Ω–∞–π—Ç–∏ —Ü—ñ–∫–∞–≤–∏—Ö –ª—é–¥–µ–π —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ñ –µ–º–æ—Ü—ñ—ó.</p>
                </div>
            </div>
            <div class="w-full mt-8">
                 <button id="next-onboarding-step" class="w-full text-lg font-bold py-4 bg-gradient-animated text-white rounded-2xl transition-transform duration-200 btn-primary relative overflow-hidden">–î–∞–ª—ñ</button>
            </div>
        </div>

        <!-- –ì–æ–ª–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω -->
        <div id="main-screen" class="hidden w-full h-full flex flex-col p-4">
            <div class="text-center pt-8">
                <h1 class="text-4xl font-extrabold text-gradient">HearMe</h1>
                <p class="text-gray-400 mt-2 px-4">–ó–Ω–∞–π–¥–∏ —Å–≤–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫–∞ —É —Å–≤—ñ—Ç—ñ, —â–æ –∑–∞–≤–∂–¥–∏ —Å–ª—É—Ö–∞—î. –î–≤–∞ –∫–ª—ñ–∫–∏ –¥–æ –Ω–æ–≤–æ—ó —Ä–æ–∑–º–æ–≤–∏.</p>
            </div>
            <div class="flex-grow flex flex-col items-center justify-center space-y-6">
                <button data-mode="voice" class="start-search-btn w-full max-w-xs text-lg font-bold py-6 bg-gradient-animated text-white rounded-2xl transition-transform duration-200 btn-primary relative overflow-hidden flex items-center justify-center space-x-3">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                    <span>–ì–æ–ª–æ—Å–æ–≤–µ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è</span>
                </button>
                <button data-mode="text" class="start-search-btn w-full max-w-xs text-lg font-bold py-6 bg-gray-700 hover:bg-gray-600 text-white rounded-2xl transition-transform duration-200 active:scale-95 relative overflow-hidden flex items-center justify-center space-x-3">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                    <span>–¢–µ–∫—Å—Ç–æ–≤–∏–π —á–∞—Ç</span>
                </button>
            </div>
            <div class="pb-4 space-y-2">
                <div class="accordion-item glassmorphism rounded-xl px-4 py-3">
                    <div class="accordion-header flex justify-between items-center cursor-pointer">
                        <h3 class="font-semibold">–ü—Ä–∞–≤–∏–ª–∞ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏</h3>
                        <svg class="accordion-icon w-6 h-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="accordion-content pt-2 text-gray-400 text-sm">
                        <p>1. –ü–æ–≤–∞–∂–∞–π—Ç–µ —ñ–Ω—à–∏—Ö. –ë—É–¥—å-—è–∫—ñ –æ–±—Ä–∞–∑–∏, –ø—Ä–∏–Ω–∏–∂–µ–Ω–Ω—è –∞–±–æ –ø–æ–≥—Ä–æ–∑–∏ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ.</p>
                        <p>2. –ñ–æ–¥–Ω–æ—ó –¥–∏—Å–∫—Ä–∏–º—ñ–Ω–∞—Ü—ñ—ó –∑–∞ –±—É–¥—å-—è–∫–æ—é –æ–∑–Ω–∞–∫–æ—é.</p>
                        <p>3. –ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–Ω—è –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–≥–æ –∞–±–æ —à–æ–∫—É—é—á–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É.</p>
                    </div>
                </div>
                 <div class="accordion-item glassmorphism rounded-xl px-4 py-3">
                    <div class="accordion-header flex justify-between items-center cursor-pointer">
                        <h3 class="font-semibold">–ü—Ä–æ –¥–æ–¥–∞—Ç–æ–∫</h3>
                        <svg class="accordion-icon w-6 h-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                    <div class="accordion-content pt-2 text-gray-400 text-sm">
                        <p>HearMe - —Ü–µ –∞–Ω–æ–Ω—ñ–º–Ω–∏–π —á–∞—Ç –¥–ª—è –ø–æ—à—É–∫—É –Ω–æ–≤–∏—Ö –∑–Ω–∞–π–æ–º—Å—Ç–≤ —Ç–∞ —Ü—ñ–∫–∞–≤–∏—Ö —Ä–æ–∑–º–æ–≤. –ú–∏ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —ñ—Å—Ç–æ—Ä—ñ—é –≤–∞—à–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –ø–æ—à—É–∫—É -->
        <div id="search-screen" class="hidden w-full h-full flex flex-col p-4">
            <div class="flex-grow flex flex-col items-center justify-center">
                <div id="voice-search-animation" class="hidden w-64 h-64 relative flex items-center justify-center">
                    <div class="w-full h-full rounded-full border-2 border-[var(--gradient-to)] opacity-30"></div>
                    <div class="w-2/3 h-2/3 rounded-full border-2 border-[var(--gradient-to)] opacity-40 absolute"></div>
                    <div class="w-1/3 h-1/3 rounded-full border-2 border-[var(--gradient-to)] opacity-50 absolute"></div>
                    <div class="radar-scanner w-full h-full rounded-full absolute"></div>
                    <svg class="w-16 h-16 text-[var(--gradient-to)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                </div>
                <div id="text-search-animation" class="hidden w-64 h-64 flex items-center justify-center">
                     <svg class="w-24 h-24 text-orange-500 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                </div>
                <h2 class="text-2xl font-semibold mt-8">–ü–æ—à—É–∫ —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫–∞<span class="typing-animation"></span></h2>
                <button id="cancel-search-btn" class="mt-12 text-lg font-semibold py-3 px-8 bg-gray-700 hover:bg-gray-600 text-white rounded-2xl transition-transform duration-200 active:scale-95 relative overflow-hidden">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω —á–∞—Ç—É -->
        <div id="chat-screen" class="hidden w-full h-full flex flex-col p-2 glassmorphism rounded-3xl">
            <div class="flex-shrink-0 flex items-center justify-between p-3 border-b border-white/10">
                <div class="font-semibold">
                    –†–æ–∑–º–æ–≤–∞ <span id="chat-timer" class="ml-2">00:00</span>
                </div>
                <button id="end-chat-btn" class="text-lg font-semibold py-2 px-4 bg-red-600 hover:bg-red-500 text-white rounded-xl transition-transform duration-200 active:scale-95 relative overflow-hidden">–ó–∞–≤–µ—Ä—à–∏—Ç–∏</button>
            </div>
            
            <!-- –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —á–∞—Ç—É -->
            <div id="voice-chat-interface" class="hidden flex-1 flex-col items-center justify-between p-4">
                <div class="flex items-center justify-around w-full">
                     <div id="user-avatar" class="flex flex-col items-center space-y-3">
                         <div class="w-28 h-28 rounded-full bg-gray-700/50 flex items-center justify-center border-2 border-transparent transition-all duration-200">
                             <svg class="w-16 h-16 text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                         </div>
                         <span class="font-semibold">–í–∏</span>
                     </div>
                     <div id="partner-avatar" class="flex flex-col items-center space-y-3">
                         <div class="w-28 h-28 rounded-full bg-gray-700/50 flex items-center justify-center border-2 border-transparent transition-all duration-200">
                              <svg class="w-16 h-16 text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                         </div>
                         <span class="font-semibold">–°–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫</span>
                     </div>
                </div>
                <canvas id="audio-visualizer" class="w-full h-24"></canvas>
                 <button id="mic-toggle-btn" class="p-5 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors">
                    <svg id="mic-icon" class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                </button>
            </div>

            <!-- –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —á–∞—Ç—É -->
            <div id="text-chat-interface" class="hidden flex-1 flex flex-col">
                <div id="message-container" class="flex-1 p-4 space-y-4 overflow-y-auto">
                    <!-- –°—é–¥–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏—Å—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
                </div>
                <div class="flex-shrink-0 p-3 border-t border-white/10">
                    <form id="message-form" class="flex items-center space-x-2">
                        <input id="message-input" type="text" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." class="flex-1 w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <button type="submit" class="p-3 bg-gradient-animated text-white rounded-full transition-transform active:scale-90">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –ø—ñ—Å–ª—è —á–∞—Ç—É -->
        <div id="post-chat-screen" class="hidden w-full h-full flex-col items-center justify-center p-4">
             <svg class="w-20 h-20 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            <h2 class="text-3xl font-bold mt-6">–î—ñ–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</h2>
            <p class="text-gray-400 mt-2">–ë–∞–∂–∞—î—Ç–µ –∑–Ω–∞–π—Ç–∏ –Ω–æ–≤–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫–∞?</p>
            <div class="mt-12 flex flex-col space-y-4 w-full max-w-xs">
                <button id="next-chat-btn" class="w-full text-lg font-bold py-4 bg-gradient-animated text-white rounded-2xl transition-transform duration-200 btn-primary relative overflow-hidden">–ù–∞—Å—Ç—É–ø–Ω–∏–π —Å–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫</button>
                <button id="main-menu-btn" class="w-full text-lg font-semibold py-4 bg-gray-700 hover:bg-gray-600 text-white rounded-2xl transition-transform duration-200 active:scale-95 relative overflow-hidden">–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è -->
    <div id="confirmation-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
        <div class="glassmorphism rounded-2xl p-6 w-full max-w-sm text-center">
            <h3 id="modal-title" class="text-xl font-bold">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</h3>
            <p id="modal-text" class="text-gray-300 mt-2">–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –¥—ñ–∞–ª–æ–≥?</p>
            <div class="mt-6 flex justify-center space-x-4">
                <button id="modal-cancel-btn" class="font-semibold py-2 px-6 bg-gray-600 hover:bg-gray-500 rounded-lg transition-colors">–ù—ñ</button>
                <button id="modal-confirm-btn" class="font-bold py-2 px-6 bg-red-600 hover:bg-red-500 rounded-lg transition-colors">–¢–∞–∫</button>
            </div>
        </div>
    </div>
    
    <!-- –°–ø–ª–∏–≤–∞—é—á—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (—Ç–æ—Å—Ç–∏) -->
    <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col items-end space-y-2"></div>

    <!-- –ê—É–¥—ñ–æ –¥–ª—è –µ—Ñ–µ–∫—Ç—ñ–≤ -->
    <audio id="click-sound" src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"></audio>
    <audio id="connect-sound" src="data:audio/wav;base64,UklGRlIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhZAAAAAAPAAAADwAAABoAAAAlAAAAKgAAAC8AAAAyAAAANwAAADsAAAA/AAAAPwAAAD4AAAA9AAAANwAAADAAAAAqAAAAJQAAAB4AAAAbAAAAFQAAABMAAAAPAAAADQAAAAoAAAAHAAAAAwAAAAEAAAAAAAAA/////wAAAP8AAAD/AAAAAgAAAAcAAAAMAAAADwAAABMAAAAWAAAAHAAAACEAAAApAAAALgAAADIAAAA2AAAAPAAAAD8AAAA/AAAAPgAAADsAAAA3AAAAMgAAACsAAAAkAAAAHAAAABgAAAATAAAADAAAAAgAAAAEAAAAAQAAAAAAAAAA/////wAAAP8AAAD/AAAAAQAAAAYAAAALAAAADgAAABIAAAAVAAAAHAAAASEAAAAoAAAALQAAADEAAAA1AAAAOwAAAD4AAAA+AAAAPAAAADgAAADAAAAArAAAAJQAAAB0AAAAYAAAAEgAAAAwAAAAHAAAAAwAAAAEAAAAAAAAAAP////8AAAD/AAAA/wAAAAEAAAAFAAAACgAAAAsAAAANAAAADQAAAA0AAAAMAAAACwAAAAkAAAAHAAAABgAAAAUAAAAEAAAAAwAAAAIAAAABAAAAAAAAAAD/////AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAAAAABAAMABQAHAAsADAAOAA8AEQATABUAFwAZABsAHQAeACAAIgAkACYAKQAqACwALgAwADEAMwA1ADYAOAA6ADwAPgBAAEEAQwBFAEcASQBLAE0ATwBRAFMAVQBXAFkAWwBdAF8AYQBjAGUAZwBpAGsAbQBuAHA"></audio>
    <audio id="disconnect-sound" src="data:audio/wav;base64,UklGRjwAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhGAAAAAAA/wAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAcAAAAHAAAABgAAAAUAAAAEAAAAAwAAAAIAAAABAAAAAAAAAAD/AAAA"></audio>
    
    <audio id="remote-audio" autoplay></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("[Client] üèÅ –°–∫—Ä–∏–ø—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ. –í–µ—Ä—Å—ñ—è 2.1 - Polished Voice UI.");
            const allScreens = document.querySelectorAll('.w-full.max-w-md > div');
            const preloaderScreen = document.getElementById('preloader-screen');
            const onboardingScreen = document.getElementById('onboarding-screen');
            const mainScreen = document.getElementById('main-screen');
            const searchScreen = document.getElementById('search-screen');
            const chatScreen = document.getElementById('chat-screen');
            const postChatScreen = document.getElementById('post-chat-screen');
            const backgroundShapes = document.getElementById('background-shapes');
            const modal = document.getElementById('confirmation-modal');
            const cancelSearchBtn = document.getElementById('cancel-search-btn');
            
            let currentMode = null; 
            let timerInterval = null;

            function showScreen(screenToShow) {
                console.log(`[Client UI] üñ•Ô∏è –ü–æ–∫–∞–∑—É—î–º–æ –µ–∫—Ä–∞–Ω: ${screenToShow.id}`);
                allScreens.forEach(screen => {
                    screen.classList.add('hidden');
                });
                screenToShow.classList.remove('hidden');
            }

            const clickSound = document.getElementById('click-sound');
            const connectSound = document.getElementById('connect-sound');
            const disconnectSound = document.getElementById('disconnect-sound');
            function playSound(sound) {
                try {
                    sound.currentTime = 0;
                    sound.play();
                } catch(e) { console.warn("–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –∑–≤—É–∫:", e); }
            }
            document.querySelectorAll('button, .accordion-header').forEach(el => {
                el.addEventListener('click', () => playSound(clickSound));
            });

            const shapeCount = 15;
            for (let i = 0; i < shapeCount; i++) {
                const shape = document.createElement('div');
                const size = Math.random() * 80 + 20;
                shape.style.width = `${size}px`; shape.style.height = `${size}px`;
                shape.style.top = `${Math.random() * 100}%`; shape.style.left = `${Math.random() * 100}%`;
                shape.style.opacity = Math.random() * 0.5 + 0.1;
                backgroundShapes.appendChild(shape);
            }
            document.body.addEventListener('mousemove', (e) => {
                const { clientX, clientY } = e; const { innerWidth, innerHeight } = window;
                const moveX = (clientX / innerWidth - 0.5) * -40; const moveY = (clientY / innerHeight - 0.5) * -40;
                backgroundShapes.style.transform = `translate(${moveX}px, ${moveY}px)`;
            });

            document.body.addEventListener('click', (e) => {
                const target = e.target.closest('.relative.overflow-hidden');
                if (target) {
                    const rect = target.getBoundingClientRect(); const ripple = document.createElement('span');
                    ripple.className = 'ripple';
                    ripple.style.left = `${e.clientX - rect.left}px`; ripple.style.top = `${e.clientY - rect.top}px`;
                    target.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 600);
                }
            });
            
            function showToast(message, isError = false) {
                const toastContainer = document.getElementById('toast-container'); const toast = document.createElement('div');
                toast.className = `px-4 py-2 rounded-lg shadow-lg text-white text-sm ${isError ? 'bg-red-600' : 'glassmorphism'} fade-in`;
                toast.textContent = message;
                toastContainer.appendChild(toast);
                setTimeout(() => { toast.remove(); }, 3400);
            }

            let confirmCallback = null;
            function showModal(title, text, onConfirm) {
                document.getElementById('modal-title').textContent = title; document.getElementById('modal-text').textContent = text;
                confirmCallback = onConfirm;
                modal.classList.remove('hidden');
            }
            document.getElementById('modal-cancel-btn').addEventListener('click', () => modal.classList.add('hidden'));
            document.getElementById('modal-confirm-btn').addEventListener('click', () => {
                modal.classList.add('hidden');
                if (confirmCallback) confirmCallback();
            });

            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => { header.parentElement.classList.toggle('active'); });
            });

            const onboardingSteps = document.querySelectorAll('.onboarding-step');
            const nextOnboardingBtn = document.getElementById('next-onboarding-step');
            let currentStep = 0;
            nextOnboardingBtn.addEventListener('click', () => {
                onboardingSteps[currentStep].classList.add('hidden');
                currentStep++;
                if (currentStep < onboardingSteps.length) {
                    onboardingSteps[currentStep].classList.remove('hidden');
                    if (currentStep === onboardingSteps.length - 1) { nextOnboardingBtn.textContent = '–†–æ–∑–ø–æ—á–∞—Ç–∏!'; }
                } else {
                    localStorage.setItem('onboardingCompleted', 'true');
                    showScreen(mainScreen);
                }
            });

            setTimeout(() => {
                const onboardingCompleted = localStorage.getItem('onboardingCompleted');
                if (onboardingCompleted) { showScreen(mainScreen); } else { showScreen(onboardingScreen); }
            }, 2000);

            document.querySelectorAll('.start-search-btn').forEach(btn => {
                btn.addEventListener('click', () => startSearch(btn.dataset.mode));
            });
            
            cancelSearchBtn.addEventListener('click', () => {
                sendMessage({ type: 'cancel_search' });
                showScreen(mainScreen);
            });

            document.getElementById('end-chat-btn').addEventListener('click', () => {
                showModal('–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥—ñ–∞–ª–æ–≥—É', '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–æ–∑–º–æ–≤—É?', endChat);
            });

            document.getElementById('next-chat-btn').addEventListener('click', () => startSearch(currentMode));
            document.getElementById('main-menu-btn').addEventListener('click', () => {
                 messageContainer.innerHTML = '';
                 showScreen(mainScreen);
            });

            const messageForm = document.getElementById('message-form');
            const messageInput = document.getElementById('message-input');
            const messageContainer = document.getElementById('message-container');

            messageForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const messageText = messageInput.value.trim();
                if (messageText) {
                    addMessage(messageText, 'my');
                    sendMessage({ type: 'text_message', content: messageText });
                    messageInput.value = '';
                }
            });

            function addMessage(text, type) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${type === 'my' ? 'justify-end' : 'justify-start'}`;
                const bubble = document.createElement('div');
                bubble.className = `chat-message p-3 rounded-2xl ${type === 'my' ? 'bg-gradient-animated text-white' : 'bg-gray-700'}`;
                bubble.textContent = text;
                messageDiv.appendChild(bubble);
                messageContainer.appendChild(messageDiv);
                messageContainer.scrollTop = messageContainer.scrollHeight;
            }

            function startSearch(mode) {
                currentMode = mode;
                document.getElementById('voice-search-animation').classList.toggle('hidden', mode !== 'voice');
                document.getElementById('text-search-animation').classList.toggle('hidden', mode !== 'text');
                showScreen(searchScreen);
                
                if (!socket || socket.readyState === WebSocket.CLOSED) { connectToServer(); } else { sendMessage({ type: 'start_search', mode: currentMode }); }
            }

            function showChatScreen(mode) {
                playSound(connectSound);
                document.getElementById('voice-chat-interface').classList.toggle('hidden', mode !== 'voice');
                document.getElementById('text-chat-interface').classList.toggle('hidden', mode !== 'text');
                showScreen(chatScreen);
                startTimer();
            }

            function endChat() {
                playSound(disconnectSound);
                stopTimer();
                closeVoiceChat();
                sendMessage({ type: 'end_chat' });
                showScreen(postChatScreen);
            }

            function startTimer() {
                stopTimer(); let seconds = 0; const timerEl = document.getElementById('chat-timer');
                timerEl.textContent = '00:00';
                timerInterval = setInterval(() => {
                    seconds++; const min = String(Math.floor(seconds / 60)).padStart(2, '0');
                    const sec = String(seconds % 60).padStart(2, '0');
                    timerEl.textContent = `${min}:${sec}`;
                }, 1000);
            }
            function stopTimer() { clearInterval(timerInterval); }


            // =================================================================
            // WEBRTC –õ–û–ì–Ü–ö–ê
            // =================================================================
            let peerConnection;
            let localStream;
            let audioVisualizerCanvas, canvasCtx, visualizerAnimation;
            const remoteAudio = document.getElementById('remote-audio');
            const micBtn = document.getElementById('mic-toggle-btn');
            const micIcon = document.getElementById('mic-icon');
            const userAvatar = document.getElementById('user-avatar').querySelector('div');
            const partnerAvatar = document.getElementById('partner-avatar').querySelector('div');

            const iceServers = {
                iceServers: [ { urls: 'stun:stun.l.google.com:19302' }, { urls: 'stun:stun1.l.google.com:19302' }]
            };

            async function startVoiceChat(role) {
                console.log(`[WebRTC] –ü–æ—á–∏–Ω–∞—î–º–æ –≥–æ–ª–æ—Å–æ–≤–∏–π —á–∞—Ç —É —Ä–æ–ª—ñ: ${role}`);
                try {
                    localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    peerConnection = new RTCPeerConnection(iceServers);
                    
                    localStream.getTracks().forEach(track => {
                        peerConnection.addTrack(track, localStream);
                    });

                    peerConnection.ontrack = (event) => {
                        console.log('[WebRTC] –û—Ç—Ä–∏–º–∞–Ω–æ –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π –∞—É–¥—ñ–æ–ø–æ—Ç—ñ–∫!');
                        if (event.streams && event.streams[0]) {
                            remoteAudio.srcObject = event.streams[0];
                            setupAudioVisualizer(event.streams[0]);
                        }
                    };

                    peerConnection.onicecandidate = (event) => {
                        if (event.candidate) {
                            sendMessage({ type: 'webrtc_signal', signal: { candidate: event.candidate } });
                        }
                    };

                    if (role === 'caller') {
                        const offer = await peerConnection.createOffer();
                        await peerConnection.setLocalDescription(offer);
                        sendMessage({ type: 'webrtc_signal', signal: { sdp: peerConnection.localDescription } });
                    }

                } catch (error) {
                    console.error("[WebRTC] –ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞:", error);
                    showToast("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞", true);
                    endChat();
                }
            }

            micBtn.addEventListener('click', () => {
                if (localStream) {
                    const audioTrack = localStream.getAudioTracks()[0];
                    if (audioTrack.enabled) {
                        audioTrack.enabled = false;
                        micIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L6.343 5.343m11.314 0L6.343 16.657" />`;
                    } else {
                        audioTrack.enabled = true;
                        micIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />`;
                    }
                }
            });

            function setupAudioVisualizer(stream) {
                audioVisualizerCanvas = document.getElementById('audio-visualizer');
                canvasCtx = audioVisualizerCanvas.getContext('2d');
                
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioCtx.createMediaStreamSource(stream);
                const analyser = audioCtx.createAnalyser();
                analyser.fftSize = 256;
                source.connect(analyser);

                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);

                function draw() {
                    visualizerAnimation = requestAnimationFrame(draw);
                    analyser.getByteFrequencyData(dataArray);

                    canvasCtx.clearRect(0, 0, audioVisualizerCanvas.width, audioVisualizerCanvas.height);
                    
                    let sum = 0;
                    for (let i = 0; i < bufferLength; i++) {
                        sum += dataArray[i];
                    }
                    const average = sum / bufferLength;

                    partnerAvatar.classList.toggle('speaking', average > 20);

                    const barWidth = (audioVisualizerCanvas.width / bufferLength) * 2.5;
                    let barHeight;
                    let x = 0;

                    const gradient = canvasCtx.createLinearGradient(0, 0, audioVisualizerCanvas.width, 0);
                    gradient.addColorStop(0, "rgba(239, 68, 68, 0.7)");
                    gradient.addColorStop(1, "rgba(249, 115, 22, 0.7)");
                    canvasCtx.fillStyle = gradient;

                    for(let i = 0; i < bufferLength; i++) {
                        barHeight = dataArray[i] / 2;
                        canvasCtx.fillRect(x, audioVisualizerCanvas.height - barHeight, barWidth, barHeight);
                        x += barWidth + 1;
                    }
                }
                draw();
            }

            async function handleRtcSignal(signal) {
                if (signal.sdp) {
                    await peerConnection.setRemoteDescription(new RTCSessionDescription(signal.sdp));
                    if (signal.sdp.type === 'offer') {
                        const answer = await peerConnection.createAnswer();
                        await peerConnection.setLocalDescription(answer);
                        sendMessage({ type: 'webrtc_signal', signal: { sdp: peerConnection.localDescription } });
                    }
                } else if (signal.candidate) {
                    await peerConnection.addIceCandidate(new RTCIceCandidate(signal.candidate));
                }
            }

            function closeVoiceChat() {
                cancelAnimationFrame(visualizerAnimation);
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                    localStream = null;
                }
                if (peerConnection) {
                    peerConnection.close();
                    peerConnection = null;
                }
                remoteAudio.srcObject = null;
                userAvatar.classList.remove('speaking');
                partnerAvatar.classList.remove('speaking');
                console.log('[WebRTC] –ì–æ–ª–æ—Å–æ–≤–∏–π —á–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ —Ç–∞ –æ—á–∏—â–µ–Ω–æ.');
            }

            // =================================================================
            // WebSocket –õ–û–ì–Ü–ö–ê
            // =================================="WebSocket"
            let socket = null;
            const SERVER_URL = "wss://hearmeapp.onrender.com";

            function connectToServer() {
                console.log(`[Client] üöÄ –°–ø—Ä–æ–±–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞: ${SERVER_URL}`);
                socket = new WebSocket(SERVER_URL);

                socket.onopen = function(event) {
                    console.log("[Client] ‚úÖ –ó'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!");
                    showToast("–ó'—î–¥–Ω–∞–Ω–æ –∑ —Å–µ—Ä–≤–µ—Ä–æ–º");
                    sendMessage({ type: 'start_search', mode: currentMode });
                };

                socket.onmessage = function(event) {
                    try {
                        const message = JSON.parse(event.data);
                        // console.log(`[Client] ‚öôÔ∏è –û–ë–†–û–ë–ö–ê –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø:`, message);

                        switch (message.type) {
                            case 'partner_found':
                                if (searchScreen.classList.contains('hidden')) { return; }
                                showChatScreen(currentMode);
                                if (currentMode === 'voice') {
                                    startVoiceChat(message.role);
                                }
                                break;
                            case 'text_message':
                                addMessage(message.content, 'partner');
                                break;
                            case 'partner_disconnected':
                                showToast("–°–ø—ñ–≤—Ä–æ–∑–º–æ–≤–Ω–∏–∫ –≤—ñ–¥'—î–¥–Ω–∞–≤—Å—è", true);
                                if (!chatScreen.classList.contains('hidden')) { endChat(); }
                                break;
                            case 'webrtc_signal':
                                if (peerConnection) { handleRtcSignal(message.signal); }
                                break;
                        }
                    } catch (e) {
                         console.error("[Client] ‚ùå –ù–ï –í–î–ê–õ–û–°–Ø –û–ë–†–û–ë–ò–¢–ò –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø:", e);
                    }
                };

                socket.onclose = function(event) {
                    console.warn("[Client] üîå –ó'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º –∑–∞–∫—Ä–∏—Ç–æ.");
                    showToast("–ó'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º –≤—Ç—Ä–∞—á–µ–Ω–æ", true);
                    closeVoiceChat();
                    if (!mainScreen.classList.contains('hidden')) { showScreen(mainScreen); }
                };

                socket.onerror = function(error) {
                    console.error(`[Client] ‚ùå –ü–æ–º–∏–ª–∫–∞ WebSocket!`, error);
                    showToast("–ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º", true);
                };
            }

            function sendMessage(message) {
                if (socket && socket.readyState === WebSocket.OPEN) {
                    socket.send(JSON.stringify(message));
                } else {
                    console.error("[Client] –ù–µ–º–æ–∂–ª–∏–≤–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. –ó'—î–¥–Ω–∞–Ω–Ω—è –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.");
                }
            }
        });
    </script>
</body>
</html>
